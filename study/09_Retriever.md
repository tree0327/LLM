# 검색기 (Retriever): 아끼는 사서 🕵️‍♂️

아키텍트님, 드디어 우리가 저장한 지식을 **"꺼내 볼"** 시간입니다.
이 과정을 **Retrieval (검색)**이라고 합니다.

---

## 1. 아키텍트의 시선: "가장 비슷한 게 뭐야?"

우리가 도서관(Vector DB)에 책을 꽂아뒀습니다.
이제 사서(Retriever)에게 이렇게 묻습니다.

> **사용자**: "회사 복지 포인트 얼마야?" (질문 벡터: `[0.1, 0.8, 0.5]`)
>
> **사서**: (책장을 뒤지며)
> *   문서 A ("사과 가격"): `[0.9, 0.1, 0.1]` (거리가 멂 ❌)
> *   문서 B ("서울 인구"): `[0.5, 0.5, 0.5]` (그저 그럼 🔺)
> *   문서 C ("복지 규정"): `[0.1, 0.9, 0.4]` (거리가 아주 가까움! ✅)
>
> **사서**: "여기 문서 C가 제일 비슷합니다!"

이것이 바로 **유사도 검색 (Similarity Search)**입니다.

## 2. 코드 설계도: 두 가지 방법

### 방법 1: 직접 검색하기 (`similarity_search`)
가장 직관적인 방법입니다. "이 문장과 비슷한 거 3개 가져와!"

```python
# 질문
query = "복지 포인트 얼마?"

# 검색 (k=3은 3개 가져오라는 뜻)
docs = vector_db.similarity_search(query, k=3)

print(docs[0].page_content) # 가장 비슷한 문서 내용 출력
```

### 방법 2: 자동화된 사서 (`as_retriever`)
나중에 **"체인(Chain)"**을 만들 때 쓰이는 부품입니다.
매번 `similarity_search` 함수를 호출하기 귀찮으니까, 아예 **"검색 전용 기계"**로 포장하는 겁니다.

```python
# DB를 검색기(Tool)로 변신시킴
retriever = vector_db.as_retriever(
    search_type="similarity",
    search_kwargs={"k": 3} # 3개 찾아오라는 설정
)

# 이제 이 'retriever'는 체인에 끼워 넣기만 하면 알아서 동작합니다.
```

---

## 3. 심화 질문: MMR (다양성)

> **"비슷한 거 3개 가져오라고 했더니, 똑같은 내용(중복)만 3개 가져오면 어떡하죠?"**

이럴 때 쓰는 고급 기술이 **MMR (Maximal Marginal Relevance)**입니다.
*   **기본 검색**: "제일 비슷한 거 1, 2, 3등 가져와." (1, 2, 3등이 내용이 거의 같을 수 있음)
*   **MMR 검색**: "비슷하되, **서로 좀 다른 내용**으로 섞어서 가져와." (다양성 확보)

```python
retriever = vector_db.as_retriever(
    search_type="mmr", # 다양성 중시
    search_kwargs={"k": 3}
)
```

이제 **"검색(Retrieve)"**까지 마스터하셨습니다.
RAG의 마지막 조각, **"이 검색된 내용을 가지고 답변하기(Generation)"**로 넘어가시겠습니까? 멍! 🐶
